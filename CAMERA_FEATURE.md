# 拍照和选择图片功能说明

## 功能概述

首页提供了两个独立的按钮，分别用于不同的图片获取方式：

### 1. 拍照按钮 📷

**功能**：直接调用设备摄像头拍摄照片

**实现方式**：
```typescript
const handleTakePhoto = async () => {
  const res = await Taro.chooseMedia({
    count: 1,
    mediaType: ['image'],
    sourceType: ['camera'],  // 仅使用摄像头
    sizeType: ['compressed']
  })
  
  if (res.tempFiles && res.tempFiles.length > 0) {
    const imagePath = res.tempFiles[0].tempFilePath
    setSelectedImage(imagePath)
  }
}
```

**技术说明**：
- 使用 `Taro.chooseMedia` API（推荐）
- 比 `Taro.chooseImage` 更可靠地唤醒相机
- 支持微信小程序和H5环境

**使用场景**：
- 现场实时拍摄车辆信息
- 需要即时获取最新图片
- 快速登记流程

**操作流程**：
1. 点击"拍照"按钮
2. 系统调用摄像头
3. 拍摄照片
4. 照片自动显示在预览区
5. 点击"开始识别"进行AI识别

### 2. 选择图片按钮 🖼️

**功能**：从设备相册中选择已有图片

**实现方式**：
```typescript
const handleChooseImage = async () => {
  const res = await Taro.chooseImage({
    count: 1,
    sizeType: ['compressed'],
    sourceType: ['album']  // 仅使用相册
  })
}
```

**使用场景**：
- 使用之前拍摄的照片
- 从其他来源获得的图片
- 需要选择特定照片

**操作流程**：
1. 点击"选择图片"按钮
2. 打开设备相册
3. 浏览并选择图片
4. 图片自动显示在预览区
5. 点击"开始识别"进行AI识别

## 技术细节

### API 对比

| API | 拍照按钮 | 选择图片按钮 |
|-----|---------|-------------|
| 使用API | **Taro.chooseMedia** | Taro.chooseImage |
| count | 1 | 1 |
| mediaType | ['image'] | - |
| sourceType | **['camera']** | ['album'] |
| sizeType | ['compressed'] | ['compressed'] |

### 为什么拍照使用 chooseMedia？

**Taro.chooseMedia 的优势**：
1. ✅ 更可靠地唤醒相机
2. ✅ 更好的跨平台支持
3. ✅ 微信小程序推荐使用
4. ✅ 支持更多媒体类型控制

**与 chooseImage 的区别**：
- `chooseImage`：旧版API，在某些环境下可能不会直接唤醒相机
- `chooseMedia`：新版API，专门优化了相机调用体验

### 返回值处理

**chooseMedia 返回值**：
```typescript
{
  tempFiles: [{
    tempFilePath: string,  // 临时文件路径
    size: number,          // 文件大小
    // ... 其他属性
  }]
}
```

**chooseImage 返回值**：
```typescript
{
  tempFilePaths: string[],  // 临时文件路径数组
  tempFiles: [{
    path: string,
    size: number
  }]
}
```

### 关键区别

**sourceType 参数**是区分两个功能的关键：

- `sourceType: ['camera']` - 只允许使用摄像头拍照
- `sourceType: ['album']` - 只允许从相册选择

### 图片处理流程

无论使用哪种方式获取图片，后续处理流程相同：

```
获取图片 → 显示预览 → 压缩图片 → 转Base64 → AI识别 → 显示结果
```

## 用户界面

### 按钮设计

**拍照按钮**：
- 图标：📷 相机图标
- 文字：拍照
- 颜色：主色调（蓝色）
- 位置：第一个按钮

**选择图片按钮**：
- 图标：🖼️ 图片图标
- 文字：选择图片
- 颜色：次要色调（浅蓝色）
- 位置：第二个按钮

### 视觉反馈

- 点击按钮时有视觉反馈
- 识别过程中按钮禁用
- 显示"识别中..."状态

## 兼容性

### 微信小程序

✅ 完全支持
- 拍照功能正常
- 相册选择正常
- 权限自动申请

### H5浏览器

⚠️ 部分支持
- 拍照功能：需要浏览器支持摄像头权限
- 相册选择：使用文件选择器

### 权限要求

**微信小程序**：
- 摄像头权限（拍照时自动申请）
- 相册权限（选择图片时自动申请）

**H5浏览器**：
- 摄像头权限（需要HTTPS）
- 文件访问权限

## 错误处理

### 拍照失败

可能原因：
- 用户拒绝摄像头权限
- 摄像头被其他应用占用
- 设备不支持摄像头

处理方式：
```typescript
catch (error) {
  Taro.showToast({
    title: '拍照失败',
    icon: 'none'
  })
}
```

### 选择图片失败

可能原因：
- 用户拒绝相册权限
- 用户取消选择
- 图片格式不支持

处理方式：
```typescript
catch (error) {
  Taro.showToast({
    title: '选择图片失败',
    icon: 'none'
  })
}
```

## 最佳实践

### 用户引导

1. **首次使用**
   - 提示用户两个按钮的区别
   - 说明拍照按钮会调用摄像头
   - 说明选择图片按钮会打开相册

2. **权限申请**
   - 首次使用时会申请相应权限
   - 如果用户拒绝，提示如何在设置中开启

3. **图片质量**
   - 建议使用拍照功能获取清晰图片
   - 确保光线充足
   - 避免模糊和反光

### 性能优化

1. **图片压缩**
   - 自动压缩图片到合适大小
   - 减少上传时间
   - 提高识别速度

2. **缓存处理**
   - 临时文件自动清理
   - 避免占用过多存储空间

## 测试建议

### 功能测试

- [ ] 拍照按钮能正常调用摄像头
- [ ] 选择图片按钮能正常打开相册
- [ ] 两个按钮功能互不干扰
- [ ] 图片预览正常显示
- [ ] 识别功能正常工作

### 兼容性测试

- [ ] 微信小程序环境测试
- [ ] H5浏览器环境测试
- [ ] 不同设备测试
- [ ] 不同系统版本测试

### 权限测试

- [ ] 首次申请权限流程
- [ ] 拒绝权限后的处理
- [ ] 重新授权流程

## 常见问题

**Q: 为什么拍照按钮不能选择相册图片？**

A: 这是设计如此。拍照按钮专门用于实时拍摄，选择图片按钮用于从相册选择。这样可以提供更清晰的用户体验。

**Q: 可以同时支持拍照和相册吗？**

A: 可以，但当前设计是分开的。如果需要合并，可以修改 `sourceType: ['camera', 'album']`。

**Q: H5环境下拍照功能为什么不工作？**

A: H5环境需要HTTPS协议才能访问摄像头。本地开发时可能无法使用拍照功能。

**Q: 如何提高识别准确率？**

A: 
1. 使用拍照功能获取清晰图片
2. 确保光线充足
3. 避免图片模糊或反光
4. 确保文字清晰可见

## 更新日志

### v2.0.1 (2025-12-10)
- 🔧 **重要修复**：拍照按钮改用 `Taro.chooseMedia` API
- ✅ 确保拍照按钮能可靠地唤醒相机
- ✅ 修复拍照和选择图片功能相同的问题
- ✅ 提升跨平台兼容性

### v2.0.0 (2025-12-10)
- ✅ 拍照按钮独立实现
- ✅ 选择图片按钮独立实现
- ✅ 两个按钮功能完全分离
- ✅ 更新使用说明文案

### v1.1.0 (2025-12-10)
- 添加拍照按钮
- 优化图片选择流程

### v1.0.0 (2025-12-06)
- 初始版本
- 基础图片选择功能
